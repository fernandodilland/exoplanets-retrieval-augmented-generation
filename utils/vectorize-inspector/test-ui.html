<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vectorize Inspector | NASA Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'nasa-blue': '#0B3D91',
                        'nasa-red': '#FC3D21',
                        'nasa-dark': '#0a0e27',
                        'nasa-gray': '#1a1f3a',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        @keyframes slide-up {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .slide-up {
            animation: slide-up 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-nasa-dark text-gray-100 min-h-screen font-sans">
    
    <!-- Header -->
    <header class="bg-gradient-to-r from-nasa-blue to-nasa-gray border-b-4 border-nasa-red">
        <div class="container mx-auto px-6 py-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-bold text-white mb-2">üöÄ VECTORIZE INSPECTOR</h1>
                    <p class="text-blue-300 text-lg">Index: <span class="text-nasa-red font-mono">autorag-rag-exoplanets</span></p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-400">Mission Control</div>
                    <div class="text-2xl font-mono text-green-400" id="statusIndicator">‚óè ONLINE</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Alert Banner -->
    <div class="bg-yellow-900/30 border-l-4 border-yellow-500 px-6 py-4">
        <div class="container mx-auto">
            <div class="flex items-center">
                <svg class="w-6 h-6 text-yellow-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                <div>
                    <p class="text-yellow-200 font-semibold">API Limitation Notice</p>
                    <p class="text-yellow-100/80 text-sm">Workers API has batch limits. For 100% export, use Wrangler CLI.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column - Controls -->
            <div class="lg:col-span-1 space-y-6">
                
                <!-- API Configuration -->
                <div class="bg-nasa-gray rounded-lg border-2 border-blue-800 p-6 slide-up">
                    <h2 class="text-xl font-bold text-blue-300 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
                        </svg>
                        API Configuration
                    </h2>
                    <input 
                        type="text" 
                        id="apiUrl" 
                        value="http://localhost:8787" 
                        placeholder="API URL"
                        class="w-full bg-nasa-dark border border-blue-700 rounded px-4 py-2 text-white font-mono focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50"
                    >
                    <p class="mt-3 text-xs text-gray-400">
                        <code class="bg-nasa-dark px-2 py-1 rounded">npm run dev</code> to start
                    </p>
                </div>

                <!-- Index Information -->
                <div class="bg-nasa-gray rounded-lg border-2 border-purple-800 p-6 slide-up" style="animation-delay: 0.1s">
                    <h2 class="text-xl font-bold text-purple-300 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                        </svg>
                        Index Operations
                    </h2>
                    <button onclick="fetchEndpoint('/info')" class="w-full bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-700 hover:to-purple-900 text-white font-semibold py-3 px-4 rounded-lg transition-all transform hover:scale-105 mb-2 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Index Info
                    </button>
                    <button onclick="fetchEndpoint('/stats')" class="w-full bg-gradient-to-r from-indigo-600 to-indigo-800 hover:from-indigo-700 hover:to-indigo-900 text-white font-semibold py-3 px-4 rounded-lg transition-all transform hover:scale-105 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"></path>
                        </svg>
                        Statistics
                    </button>
                </div>

                <!-- Vector Operations -->
                <div class="bg-nasa-gray rounded-lg border-2 border-green-800 p-6 slide-up" style="animation-delay: 0.2s">
                    <h2 class="text-xl font-bold text-green-300 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        Vector Sampling
                    </h2>
                    <button onclick="fetchEndpoint('/list?count=50')" class="w-full bg-gradient-to-r from-green-600 to-green-800 hover:from-green-700 hover:to-green-900 text-white font-bold py-3 px-4 rounded-lg transition-all transform hover:scale-105 flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                        </svg>
                        GET SAMPLE
                    </button>
                    <p class="mt-3 text-xs text-gray-400 text-center">
                        Fetches up to 50 random vectors (API max)
                    </p>
                </div>

                <!-- Export Operations -->
                <div class="bg-nasa-gray rounded-lg border-2 border-nasa-red p-6 slide-up" style="animation-delay: 0.3s">
                    <h2 class="text-xl font-bold text-red-300 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 pulse-glow" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                        Progressive Export
                    </h2>
                    <button onclick="downloadExport()" class="w-full bg-gradient-to-r from-nasa-red to-red-700 hover:from-red-600 hover:to-red-800 text-white font-bold py-4 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg hover:shadow-red-500/50 flex items-center justify-center">
                        <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd"></path>
                        </svg>
                        EXPORT ALL VECTORS
                    </button>
                    <p class="mt-3 text-xs text-gray-400 text-center">
                        Fetches up to 10 batches √ó 50 vectors
                    </p>
                </div>

                <!-- Get by ID -->
                <div class="bg-nasa-gray rounded-lg border-2 border-yellow-800 p-6 slide-up" style="animation-delay: 0.4s">
                    <h2 class="text-xl font-bold text-yellow-300 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                        </svg>
                        Get by ID
                    </h2>
                    <input 
                        type="text" 
                        id="vectorId" 
                        placeholder="Enter vector ID"
                        class="w-full bg-nasa-dark border border-yellow-700 rounded px-4 py-2 text-white font-mono focus:outline-none focus:border-yellow-500 mb-3"
                    >
                    <button onclick="fetchVectorById()" class="w-full bg-yellow-700 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded transition-all">
                        üéØ Search Vector
                    </button>
                </div>

                <!-- CLI Reference -->
                <div class="bg-nasa-dark border border-gray-700 rounded-lg p-4 slide-up" style="animation-delay: 0.5s">
                    <h3 class="text-sm font-semibold text-gray-400 mb-2">üéØ 100% Export via CLI</h3>
                    <code class="text-xs text-green-400 bg-black/50 p-2 rounded block overflow-x-auto">
                        wrangler vectorize list-vectors autorag-rag-exoplanets --count=1000 > export.json
                    </code>
                </div>

            </div>

            <!-- Right Column - Results -->
            <div class="lg:col-span-2">
                <div class="bg-nasa-gray rounded-lg border-2 border-blue-800 p-6 slide-up min-h-[600px]" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-blue-300 flex items-center">
                            <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm3.293 1.293a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L7.586 10 5.293 7.707a1 1 0 010-1.414zM11 12a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                            </svg>
                            Mission Output
                        </h2>
                        <button onclick="clearResult()" class="text-gray-400 hover:text-white transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div id="resultContent" class="bg-black/50 rounded-lg p-6 font-mono text-sm text-green-400 overflow-auto" style="max-height: 70vh;">
                        <div class="text-center text-gray-500 py-12">
                            <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm2 10a1 1 0 10-2 0v3a1 1 0 102 0v-3zm2-3a1 1 0 011 1v5a1 1 0 11-2 0v-5a1 1 0 011-1zm4-1a1 1 0 10-2 0v7a1 1 0 102 0V8z" clip-rule="evenodd"></path>
                            </svg>
                            <p class="text-lg">Ready for data transmission</p>
                            <p class="text-sm mt-2">Select an operation from the control panel</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-nasa-gray border-t border-gray-800 mt-12 py-6">
        <div class="container mx-auto px-6 text-center text-gray-400 text-sm">
            <p>Vectorize Inspector v2.0 | Mission: Vector Retrieval & Analysis</p>
            <p class="mt-2">üöÄ Powered by Cloudflare Workers & Wrangler CLI</p>
        </div>
    </footer>

    <script>
        function getApiUrl() {
            return document.getElementById('apiUrl').value;
        }

        function clearResult() {
            document.getElementById('resultContent').innerHTML = `
                <div class="text-center text-gray-500 py-12">
                    <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm2 10a1 1 0 10-2 0v3a1 1 0 102 0v-3zm2-3a1 1 0 011 1v5a1 1 0 11-2 0v-5a1 1 0 011-1zm4-1a1 1 0 10-2 0v7a1 1 0 102 0V8z" clip-rule="evenodd"></path>
                    </svg>
                    <p class="text-lg">Ready for data transmission</p>
                    <p class="text-sm mt-2">Select an operation from the control panel</p>
                </div>
            `;
        }

        async function fetchEndpoint(endpoint) {
            const resultContent = document.getElementById('resultContent');
            const statusIndicator = document.getElementById('statusIndicator');
            
            statusIndicator.className = 'text-2xl font-mono text-yellow-400 pulse-glow';
            statusIndicator.textContent = '‚óè TRANSMITTING';
            
            resultContent.innerHTML = `
                <div class="flex items-center justify-center py-12">
                    <div class="text-center">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"></div>
                        <p class="text-blue-400 text-lg">Fetching data from Vectorize...</p>
                        <p class="text-gray-500 text-sm mt-2">Endpoint: ${endpoint}</p>
                    </div>
                </div>
            `;

            try {
                const response = await fetch(getApiUrl() + endpoint);
                const data = await response.json();
                
                statusIndicator.className = 'text-2xl font-mono text-green-400';
                statusIndicator.textContent = '‚óè ONLINE';
                
                resultContent.innerHTML = `<pre class="whitespace-pre-wrap break-words">${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                statusIndicator.className = 'text-2xl font-mono text-red-400';
                statusIndicator.textContent = '‚óè ERROR';
                
                resultContent.innerHTML = `
                    <pre class="text-red-400">
<span class="text-red-500 font-bold">ERROR:</span> ${error.message}

<span class="text-yellow-400">Is the server running at ${getApiUrl()}?</span>

Run: <span class="text-green-400">npm run dev</span>
                    </pre>
                `;
            }
        }

        async function fetchVectorById() {
            const vectorId = document.getElementById('vectorId').value;
            if (!vectorId) {
                alert('‚ö†Ô∏è Please enter a vector ID');
                return;
            }
            await fetchEndpoint(`/vector/${vectorId}`);
        }

        async function downloadExport() {
            const resultContent = document.getElementById('resultContent');
            const statusIndicator = document.getElementById('statusIndicator');
            
            statusIndicator.className = 'text-2xl font-mono text-yellow-400 pulse-glow';
            statusIndicator.textContent = '‚óè EXPORTING';
            
            resultContent.innerHTML = `
                <div class="flex items-center justify-center py-12">
                    <div class="text-center">
                        <div class="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-nasa-red mb-6"></div>
                        <p class="text-nasa-red text-xl font-bold">PROGRESSIVE EXPORT IN PROGRESS</p>
                        <p class="text-blue-400 text-sm mt-3">Fetching vectors in batches of 50...</p>
                        <p class="text-gray-500 text-xs mt-2">This may take 10-15 seconds for 119 vectors</p>
                        <div class="mt-6 text-left bg-black/30 p-4 rounded max-w-md mx-auto">
                            <p class="text-green-400 text-xs mb-1">‚Üí Batch 1/10: Querying random vector space...</p>
                            <p class="text-green-400 text-xs mb-1">‚Üí Filtering duplicates...</p>
                            <p class="text-green-400 text-xs">‚Üí Preparing next batch...</p>
                        </div>
                    </div>
                </div>
            `;

            try {
                const response = await fetch(getApiUrl() + '/export');
                const data = await response.json();
                
                // Show results first
                statusIndicator.className = 'text-2xl font-mono text-green-400';
                statusIndicator.textContent = '‚óè SUCCESS';
                
                // Create nice display with metadata info
                const uniqueFiles = new Set();
                data.vectors.forEach(v => {
                    if (v.metadata && v.metadata.filename) {
                        uniqueFiles.add(v.metadata.filename);
                    }
                });
                
                let fileListHTML = '';
                if (uniqueFiles.size > 0) {
                    fileListHTML = `
                        <div class="mt-4 p-3 bg-blue-900/20 border border-blue-700 rounded">
                            <p class="text-blue-300 font-semibold text-sm mb-2">üìÅ Source Files (${uniqueFiles.size}):</p>
                            <div class="space-y-1">
                                ${Array.from(uniqueFiles).map(file => 
                                    `<p class="text-xs text-gray-300 font-mono">‚Üí ${file}</p>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                resultContent.innerHTML = `
                    <div class="mb-6 p-4 bg-green-900/30 border border-green-500 rounded">
                        <p class="text-green-400 font-bold text-lg">‚úì EXPORT COMPLETED</p>
                        <div class="mt-3 space-y-1 text-sm">
                            <p class="text-white">Vectors Fetched: <span class="text-green-400 font-bold">${data.vectorsFetched}</span> / ${data.totalVectorsInIndex}</p>
                            <p class="text-white">Completion: <span class="text-green-400 font-bold">${data.completionPercentage}%</span></p>
                            <p class="text-white">Batches Used: <span class="text-blue-400">${data.batchesUsed}</span></p>
                            <p class="text-white">Dimensions: <span class="text-purple-400">${data.dimensions}</span></p>
                        </div>
                        ${fileListHTML}
                    </div>
                    <pre class="whitespace-pre-wrap break-words">${JSON.stringify(data, null, 2)}</pre>
                `;
                
                // Download file
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `vectorize-export-${new Date().toISOString().replace(/:/g, '-').split('.')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
            } catch (error) {
                statusIndicator.className = 'text-2xl font-mono text-red-400';
                statusIndicator.textContent = '‚óè ERROR';
                
                resultContent.innerHTML = `
                    <pre class="text-red-400">
<span class="text-red-500 font-bold">EXPORT FAILED:</span> ${error.message}

<span class="text-yellow-400">Is the server running at ${getApiUrl()}?</span>

Run: <span class="text-green-400">npm run dev</span>
                    </pre>
                `;
            }
        }

        // Auto-load info on page load
        window.addEventListener('load', () => {
            fetchEndpoint('/');
        });
    </script>
</body>
</html>
